// Complete infrastructure test: VPC + Subnet + Security Group
cloud_vendor "aws" {
    region = "us-east-1"
    profile = "kyaw-zin"
}

// VPC Configuration
declare vpc_config = {
    cidr_block: "10.0.0.0/16"
    enable_dns_hostnames: true
    enable_dns_support: true
    tags: {
        Name: "test-vpc"
        Environment: "test"
        Project: "tblang-test"
        ManagedBy: "TBLang"
    }
}

// Create VPC
declare main_vpc = vpc("test-vpc", vpc_config);

// Subnet Configuration
declare subnet_config = {
    vpc_id: main_vpc
    cidr_block: "10.0.1.0/24"
    availability_zone: "us-east-1a"
    map_public_ip: true
    tags: {
        Name: "test-public-subnet"
        Environment: "test"
        Type: "public"
        Project: "tblang-test"
        ManagedBy: "TBLang"
    }
}

// Create Subnet
declare public_subnet = subnet("test-public-subnet", subnet_config);

// Security Group Configuration
declare sg_config = {
    vpc_id: main_vpc
    name: "test-web-sg"
    description: "Security group for web servers"
    ingress_rules: [
        {
            protocol: "tcp"
            from_port: 80
            to_port: 80
            cidr_blocks: ["0.0.0.0/0"]
        },
        {
            protocol: "tcp"
            from_port: 443
            to_port: 443
            cidr_blocks: ["0.0.0.0/0"]
        }
    ]
    egress_rules: [
        {
            protocol: "-1"
            from_port: 0
            to_port: 0
            cidr_blocks: ["0.0.0.0/0"]
        }
    ]
    tags: {
        Name: "test-web-sg"
        Environment: "test"
        Project: "tblang-test"
        ManagedBy: "TBLang"
    }
}

// Create Security Group
declare web_sg = security_group("test-web-sg", sg_config);
